<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeautyAI - Simple Voice Assistant</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/simple_voice.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="voice-container">
        <!-- Header -->
        <header class="voice-header">
            <div class="header-content">
                <div class="logo-section">
                    <h1><i class="fas fa-microphone-alt"></i> BeautyAI Voice</h1>
                    <p class="subtitle">AI-Powered Voice Assistant</p>
                </div>
                
                <!-- Language Selector -->
                <div class="language-selector">
                    <label for="language-toggle" class="toggle-label">
                        <span class="language-text" data-lang="en">EN</span>
                        <input type="checkbox" id="language-toggle" class="language-toggle">
                        <span class="toggle-slider"></span>
                        <span class="language-text" data-lang="ar">عربي</span>
                    </label>
                </div>
                
                <!-- Theme Toggle -->
                <div class="theme-toggle">
                    <button id="theme-btn" class="theme-btn" title="Toggle dark/light theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Connection Status -->
        <div class="connection-status" id="connection-status">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </div>

        <!-- Main Voice Interface -->
        <main class="voice-main">
            <!-- Voice Control Panel -->
            <div class="voice-control-panel">
                <!-- Recording Indicator -->
                <div class="recording-indicator" id="recording-indicator">
                    <div class="mic-container">
                        <button id="mic-button" class="mic-button" disabled>
                            <i class="fas fa-microphone"></i>
                        </button>
                        <div class="recording-animation">
                            <div class="pulse-ring"></div>
                            <div class="pulse-ring"></div>
                            <div class="pulse-ring"></div>
                        </div>
                    </div>
                    
                    <!-- VAD Status -->
                    <div class="vad-status" id="vad-status">
                        <div class="vad-indicator">
                            <span class="vad-label">Voice Detection</span>
                            <span class="vad-state" id="vad-state">Idle</span>
                        </div>
                        <div class="audio-level-bar">
                            <div class="audio-level" id="audio-level"></div>
                        </div>
                    </div>
                </div>

                <!-- Processing Status -->
                <div class="processing-status" id="processing-status">
                    <div class="processing-steps">
                        <div class="step" id="step-listening">
                            <i class="fas fa-ear-listen"></i>
                            <span>Listening</span>
                        </div>
                        <div class="step" id="step-transcribing">
                            <i class="fas fa-file-audio"></i>
                            <span>Transcribing</span>
                        </div>
                        <div class="step" id="step-thinking">
                            <i class="fas fa-brain"></i>
                            <span>Thinking</span>
                        </div>
                        <div class="step" id="step-speaking">
                            <i class="fas fa-volume-high"></i>
                            <span>Speaking</span>
                        </div>
                    </div>
                </div>

                <!-- Audio Waveform Visualization -->
                <div class="waveform-container">
                    <canvas id="waveform-canvas" width="800" height="100"></canvas>
                </div>
            </div>

            <!-- Conversation Display -->
            <div class="conversation-container">
                <div class="conversation-header">
                    <h3>Conversation</h3>
                    <div class="conversation-controls">
                        <button id="clear-conversation" class="btn-secondary">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button id="export-conversation" class="btn-secondary">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="conversation-messages" id="conversation-messages">
                    <div class="welcome-message">
                        <div class="message assistant">
                            <div class="message-content">
                                <p><span class="welcome-en">Welcome! Click the microphone button to start talking.</span><span class="welcome-ar" style="display: none;">مرحباً! اضغط على زر الميكروفون لبدء المحادثة.</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="control-group">
                <label>
                    <input type="checkbox" id="auto-speak" checked>
                    <span>Auto-play responses</span>
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="range" id="volume-slider" min="0" max="100" value="80">
                    <span>Volume: <span id="volume-value">80</span>%</span>
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="range" id="vad-sensitivity" min="0.1" max="1.0" step="0.1" value="0.5">
                    <span>VAD Sensitivity: <span id="vad-sensitivity-value">0.5</span></span>
                </label>
            </div>
        </div>

        <!-- Error Display -->
        <div class="error-display" id="error-display" style="display: none;">
            <div class="error-content">
                <i class="fas fa-exclamation-triangle"></i>
                <div class="error-message" id="error-message"></div>
                <button class="error-close" id="error-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Performance Metrics (hidden by default, shown in debug mode) -->
        <div class="metrics-panel" id="metrics-panel" style="display: none;">
            <h4>Performance Metrics</h4>
            <div class="metrics-grid">
                <div class="metric">
                    <span class="metric-label">Latency</span>
                    <span class="metric-value" id="metric-latency">0ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">VAD Accuracy</span>
                    <span class="metric-value" id="metric-vad-accuracy">0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Audio Quality</span>
                    <span class="metric-value" id="metric-audio-quality">Good</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Response Time</span>
                    <span class="metric-value" id="metric-response-time">0s</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio Element for TTS Playback -->
    <audio id="tts-audio" preload="none" style="display: none;"></audio>

    <!-- Configuration Data -->
    <script id="beautyai-config" type="application/json">{{ config|tojson|safe }}</script>
    <script id="beautyai-session" type="application/json">{{ session_id|tojson|safe }}</script>
    
    <!-- Scripts -->
    <script type="text/javascript">
        // Load configuration from JSON scripts
        window.BEAUTYAI_CONFIG = JSON.parse(document.getElementById('beautyai-config').textContent);
        window.SESSION_ID = JSON.parse(document.getElementById('beautyai-session').textContent);
    </script>
    <script src="/static/js/audioUtils.js"></script>
    <script src="/static/js/improvedVAD.js"></script>
    <script src="/static/js/simpleVoiceClient.js"></script>
    
    <script>
        // Initialize the voice client when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const voiceClient = new SimpleVoiceClient({
                containerId: 'voice-container',
                websocketUrl: window.BEAUTYAI_CONFIG.backend.simple_voice_ws,
                sessionId: window.SESSION_ID
            });
            
            voiceClient.initialize();
            
            // Global reference for debugging
            window.voiceClient = voiceClient;
        });
    </script>
</body>
</html>