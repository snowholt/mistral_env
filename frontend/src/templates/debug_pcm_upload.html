<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
    <title>BeautyAI Debug - Simple WebSocket Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Debug Interface Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/debug_simple_websocket.css') }}">
</head>
<body>
  <div class="debug-container">
    <header class="debug-header">
      <h1><i class="fas fa-microphone-lines"></i> Simple WebSocket Voice Debug Tool</h1>
      <div class="subtitle">Test STT → LLM → TTS pipeline without microphone using file upload</div>
    </header>
    
    <div class="note-banner">
      <i class="fas fa-info-circle"></i>
      <div>
        <strong>Debug the Simple WebSocket Voice Pipeline:</strong><br>
        Upload audio files (WebM, WAV, MP3, PCM) to test the complete STT → LLM → TTS pipeline via 
        <code>/api/ws/simple-voice-chat</code> endpoint with debug mode enabled. 
        Monitor each stage with detailed metrics and logs.
      </div>
    </div>

    <!-- Configuration Panel -->
    <section class="debug-panel config-panel">
      <div class="panel-header">
        <h2><i class="fas fa-cogs"></i> Configuration</h2>
        <div class="connection-status" id="connectionStatus">
          <span class="status-indicator" id="statusIndicator"></span>
          <span class="status-text" id="statusText">Disconnected</span>
        </div>
      </div>
      
      <div class="config-grid">
        <!-- Audio File Upload -->
        <div class="config-group">
          <label class="config-label">
            <i class="fas fa-file-audio"></i> Audio File
          </label>
          <div class="file-upload-area" id="fileUploadArea">
            <input type="file" id="audioFile" accept="audio/*,.pcm" hidden>
            <div class="file-upload-content">
              <i class="fas fa-cloud-upload-alt"></i>
              <div class="file-upload-text">
                <span id="fileLabel">Click to select audio file</span>
                <div class="file-upload-hint">Supports WebM, WAV, MP3, PCM</div>
              </div>
            </div>
          </div>
          <div class="file-info" id="fileInfo" style="display: none;">
            <span id="fileName"></span>
            <span id="fileSize"></span>
          </div>
        </div>

        <!-- Language Selection -->
        <div class="config-group">
          <label class="config-label">
            <i class="fas fa-language"></i> Language
          </label>
          <select id="languageSelect" class="config-select">
            <option value="ar" selected>Arabic (العربية)</option>
            <option value="en">English</option>
          </select>
        </div>

        <!-- Voice Type -->
        <div class="config-group">
          <label class="config-label">
            <i class="fas fa-user"></i> Voice Type
          </label>
          <select id="voiceTypeSelect" class="config-select">
            <option value="female" selected>Female</option>
            <option value="male">Male</option>
          </select>
        </div>

        <!-- Debug Mode -->
        <div class="config-group">
          <label class="config-label">
            <i class="fas fa-bug"></i> Debug Mode
          </label>
          <div class="toggle-switch">
            <input type="checkbox" id="debugModeToggle" checked>
            <label for="debugModeToggle" class="toggle-label"></label>
          </div>
        </div>

        <!-- WebSocket URL -->
        <div class="config-group full-width">
          <label class="config-label">
            <i class="fas fa-plug"></i> WebSocket URL
          </label>
          <input type="text" id="websocketUrl" class="config-input" readonly>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button id="connectBtn" class="btn btn-primary">
          <i class="fas fa-plug"></i> Connect
        </button>
        <button id="disconnectBtn" class="btn btn-secondary" disabled>
          <i class="fas fa-plug"></i> Disconnect
        </button>
        <button id="sendAudioBtn" class="btn btn-success" disabled>
          <i class="fas fa-paper-plane"></i> Send Audio
        </button>
        <button id="clearLogsBtn" class="btn btn-outline">
          <i class="fas fa-trash"></i> Clear Logs
        </button>
      </div>
    </section>

    <!-- Pipeline Status Panel -->
    <section class="debug-panel pipeline-panel">
      <div class="panel-header">
        <h2><i class="fas fa-sitemap"></i> Pipeline Status</h2>
        <div class="performance-grade" id="performanceGrade">
          <span class="grade-label">Performance:</span>
          <span class="grade-value" id="gradeValue">-</span>
        </div>
      </div>
      
      <div class="pipeline-stages">
        <div class="stage" id="uploadStage">
          <div class="stage-icon"><i class="fas fa-upload"></i></div>
          <div class="stage-label">Upload</div>
          <div class="stage-status">Ready</div>
          <div class="stage-timing" id="uploadTiming">-</div>
        </div>
        
        <div class="stage-arrow"><i class="fas fa-chevron-right"></i></div>
        
        <div class="stage" id="sttStage">
          <div class="stage-icon"><i class="fas fa-microphone"></i></div>
          <div class="stage-label">STT</div>
          <div class="stage-status">Waiting</div>
          <div class="stage-timing" id="sttTiming">-</div>
        </div>
        
        <div class="stage-arrow"><i class="fas fa-chevron-right"></i></div>
        
        <div class="stage" id="llmStage">
          <div class="stage-icon"><i class="fas fa-brain"></i></div>
          <div class="stage-label">LLM</div>
          <div class="stage-status">Waiting</div>
          <div class="stage-timing" id="llmTiming">-</div>
        </div>
        
        <div class="stage-arrow"><i class="fas fa-chevron-right"></i></div>
        
        <div class="stage" id="ttsStage">
          <div class="stage-icon"><i class="fas fa-volume-high"></i></div>
          <div class="stage-label">TTS</div>
          <div class="stage-status">Waiting</div>
          <div class="stage-timing" id="ttsTiming">-</div>
        </div>
      </div>
      
      <div class="pipeline-metrics">
        <div class="metric">
          <span class="metric-label">Total Time:</span>
          <span class="metric-value" id="totalTime">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">Bottleneck:</span>
          <span class="metric-value" id="bottleneckStage">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">Session ID:</span>
          <span class="metric-value" id="sessionId">-</span>
        </div>
      </div>
    </section>

    <!-- Stage Details Panel -->
    <section class="debug-panel details-panel">
      <div class="panel-header">
        <h2><i class="fas fa-chart-line"></i> Stage Details</h2>
      </div>
      
      <div class="details-tabs">
        <button class="tab-button active" data-tab="stt">
          <i class="fas fa-microphone"></i> STT
        </button>
        <button class="tab-button" data-tab="llm">
          <i class="fas fa-brain"></i> LLM
        </button>
        <button class="tab-button" data-tab="tts">
          <i class="fas fa-volume-high"></i> TTS
        </button>
      </div>
      
      <div class="details-content">
        <!-- STT Details -->
        <div class="tab-content active" id="sttDetails">
          <div class="detail-group">
            <div class="detail-row">
              <span class="detail-label">Transcribed Text:</span>
              <span class="detail-value" id="sttTranscribedText">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Language Detected:</span>
              <span class="detail-value" id="sttLanguage">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Confidence Score:</span>
              <span class="detail-value" id="sttConfidence">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Processing Time:</span>
              <span class="detail-value" id="sttProcessingTime">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Model Used:</span>
              <span class="detail-value" id="sttModel">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Audio Duration:</span>
              <span class="detail-value" id="sttAudioDuration">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Audio Format:</span>
              <span class="detail-value" id="sttAudioFormat">-</span>
            </div>
          </div>
        </div>
        
        <!-- LLM Details -->
        <div class="tab-content" id="llmDetails">
          <div class="detail-group">
            <div class="detail-row">
              <span class="detail-label">Response Text:</span>
              <span class="detail-value" id="llmResponseText">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Prompt Tokens:</span>
              <span class="detail-value" id="llmPromptTokens">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Completion Tokens:</span>
              <span class="detail-value" id="llmCompletionTokens">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Processing Time:</span>
              <span class="detail-value" id="llmProcessingTime">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Model Used:</span>
              <span class="detail-value" id="llmModel">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Temperature:</span>
              <span class="detail-value" id="llmTemperature">-</span>
            </div>
          </div>
        </div>
        
        <!-- TTS Details -->
        <div class="tab-content" id="ttsDetails">
          <div class="detail-group">
            <div class="detail-row">
              <span class="detail-label">Audio Length:</span>
              <span class="detail-value" id="ttsAudioLength">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Voice Used:</span>
              <span class="detail-value" id="ttsVoice">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Processing Time:</span>
              <span class="detail-value" id="ttsProcessingTime">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Output Format:</span>
              <span class="detail-value" id="ttsOutputFormat">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Text Length:</span>
              <span class="detail-value" id="ttsTextLength">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Speech Rate:</span>
              <span class="detail-value" id="ttsSpeechRate">-</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Response & Playback Panel -->
    <section class="debug-panel response-panel">
      <div class="panel-header">
        <h2><i class="fas fa-play-circle"></i> Response & Playback</h2>
      </div>
      
      <div class="response-content">
        <div class="transcription-box">
          <label>Transcription:</label>
          <div class="transcription-text" id="transcriptionDisplay">No transcription yet...</div>
        </div>
        
        <div class="response-box">
          <label>AI Response:</label>
          <div class="response-text" id="responseDisplay">No response yet...</div>
        </div>
        
        <div class="audio-player-box">
          <label>TTS Audio:</label>
          <div class="audio-controls">
            <audio id="ttsAudio" controls preload="none">
              <source type="audio/webm">
              Your browser does not support the audio element.
            </audio>
            <button id="downloadAudioBtn" class="btn btn-outline" disabled>
              <i class="fas fa-download"></i> Download
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Debug Events Log Panel -->
    <section class="debug-panel log-panel">
      <div class="panel-header">
        <h2><i class="fas fa-list-alt"></i> Debug Events Log</h2>
        <div class="log-controls">
          <div class="log-filters">
            <label class="filter-checkbox">
              <input type="checkbox" id="showInfoEvents" checked>
              <span>Info</span>
            </label>
            <label class="filter-checkbox">
              <input type="checkbox" id="showWarningEvents" checked>
              <span>Warning</span>
            </label>
            <label class="filter-checkbox">
              <input type="checkbox" id="showErrorEvents" checked>
              <span>Error</span>
            </label>
            <label class="filter-checkbox">
              <input type="checkbox" id="showDebugEvents">
              <span>Debug</span>
            </label>
          </div>
          <button id="exportLogsBtn" class="btn btn-outline btn-sm">
            <i class="fas fa-download"></i> Export
          </button>
        </div>
      </div>
      
      <div class="log-content">
        <div id="debugEventsLog" class="debug-log">
          <div class="log-entry initial">
            <span class="log-timestamp">00:00:00</span>
            <span class="log-level info">INFO</span>
            <span class="log-stage">SYSTEM</span>
            <span class="log-message">Debug interface ready. Upload an audio file to begin testing.</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Export Panel -->
    <section class="debug-panel export-panel">
      <div class="panel-header">
        <h2><i class="fas fa-file-export"></i> Export & Analysis</h2>
      </div>
      
      <div class="export-content">
        <div class="export-options">
          <div class="export-group">
            <label>Export Format:</label>
            <select id="exportFormat" class="config-select">
              <option value="json">JSON</option>
              <option value="csv">CSV</option>
              <option value="markdown">Markdown Report</option>
            </select>
          </div>
          
          <div class="export-actions">
            <button id="exportSessionBtn" class="btn btn-primary" disabled>
              <i class="fas fa-file-export"></i> Export Session
            </button>
            <button id="exportDebugBtn" class="btn btn-secondary" disabled>
              <i class="fas fa-bug"></i> Export Debug Data
            </button>
          </div>
        </div>
        
        <div class="session-stats">
          <div class="stat-item">
            <span class="stat-label">Sessions:</span>
            <span class="stat-value" id="sessionCount">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Avg Response Time:</span>
            <span class="stat-value" id="avgResponseTime">-</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Success Rate:</span>
            <span class="stat-value" id="successRate">-</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/debug_websocket_tester.js') }}"></script>
  
  <script>
    // Initialize the debug interface when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🔧 Initializing Simple WebSocket Debug Interface...');
      
      // Initialize the debug WebSocket client
      if (typeof DebugWebSocketTester !== 'undefined') {
        window.debugClient = new DebugWebSocketTester();
        window.debugClient.initialize();
        console.log('✅ Debug WebSocket Tester initialized');
      } else {
        console.error('❌ DebugWebSocketTester not found - check if debug_websocket_tester.js is loaded');
      }
    });
  </script>
</body>
</html>
