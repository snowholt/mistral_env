<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeautyAI - Intelligent AI Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/voice.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/transcript.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <!-- main.css aggregator deprecated: no longer linked -->
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">üé® BeautyAI</div>
        
        <button id="settingsBtn" class="settings-btn">
            ‚öôÔ∏è Settings
        </button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="welcome-screen">
                <h2>Welcome to BeautyAI</h2>
                <p>Your intelligent AI assistant for Arabic and English conversations. Choose text or voice chat and start exploring!</p>
                
                <div class="example-prompts">
                    <div class="example-prompt" onclick="setPrompt('ŸÖÿß ŸáŸä ÿ£ÿ≠ÿØÿ´ ÿ™ŸÇŸÜŸäÿßÿ™ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸäÿü')">
                        <h4>ü§ñ AI Technology</h4>
                        <p>Ask about latest AI developments in Arabic</p>
                    </div>
                    <div class="example-prompt" onclick="setPrompt('Explain quantum computing in simple terms')">
                        <h4>üî¨ Science & Tech</h4>
                        <p>Get complex topics explained simply</p>
                    </div>
                    <div class="example-prompt" onclick="setPrompt('ÿßŸÉÿ™ÿ® ŸÑŸä ŸÇÿµÿ© ŸÇÿµŸäÿ±ÿ© ÿπŸÜ ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑ')">
                        <h4>‚úçÔ∏è Creative Writing</h4>
                        <p>Generate creative content in Arabic</p>
                    </div>
                    <div class="example-prompt" onclick="setPrompt('Help me plan a healthy meal for today')">
                        <h4>üçé Health & Wellness</h4>
                        <p>Get personalized health advice</p>
                    </div>
                </div>
            </div>

            <!-- Messages Container -->
            <div id="messagesContainer" class="messages-container hidden">
                <!-- Messages will be inserted here -->
            </div>

            <!-- Input Container -->
            <div class="input-container">
                <!-- Voice Status -->
                <div id="voiceStatus" class="voice-status">
                    Listening...
                </div>

                <div class="input-wrapper">
                    <div class="input-box">
                        <textarea 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="Type your message here... (Enter to send, Shift+Enter for new line)"
                            rows="1"
                        ></textarea>
                        
                        <div class="input-actions">
                            <button id="voiceConversationBtn" class="voice-conversation-btn" title="Start Voice Conversation">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                                    <path d="M19 12c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1z"/>
                                    <path d="M7 12c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1z"/>
                                </svg>
                            </button>
                            <button id="sendBtn" class="send-btn" title="Send message">
                                ‚û§
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <!-- Connection Status -->
            <div id="connectionStatus" class="status-indicator disconnected">
                <span>‚óè</span>
                <span>Disconnected</span>
            </div>

            <!-- Model Settings -->
            <div class="settings-section">
                <h3>ü§ñ Model Settings</h3>
                
                <div class="setting-item">
                    <label for="modelSelect">Model</label>
                    <select id="modelSelect">
                        <option value="qwen3-unsloth-q4ks">Qwen3 Unsloth (Fast)</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label for="thinkingMode">Thinking Mode</label>
                    <select id="thinkingMode">
                        <option value="false">Disabled (Fast Response)</option>
                        <option value="true">Enabled (Detailed Thinking)</option>
                    </select>
                </div>
            </div>

            <!-- Generation Parameters -->
            <div class="settings-section">
                <h3>‚öôÔ∏è Generation Parameters</h3>
                
                <div class="setting-item">
                    <label for="temperature">Temperature <span id="tempValue" class="range-value">0.3</span></label>
                    <input type="range" id="temperature" min="0.1" max="2.0" step="0.1" value="0.3">
                </div>
                
                <div class="setting-item">
                    <label for="topP">Top P <span id="topPValue" class="range-value">0.95</span></label>
                    <input type="range" id="topP" min="0.1" max="1.0" step="0.05" value="0.95">
                </div>
                
                <div class="setting-item">
                    <label for="topK">Top K <span id="topKValue" class="range-value">20</span></label>
                    <input type="range" id="topK" min="1" max="100" step="1" value="20">
                </div>
                
                <div class="setting-item">
                    <label for="maxTokens">Max Tokens <span id="maxTokensValue" class="range-value">2048</span></label>
                    <input type="range" id="maxTokens" min="100" max="4096" step="100" value="2048">
                </div>
                
                <div class="setting-item">
                    <label for="repetitionPenalty">Repetition Penalty <span id="repPenaltyValue" class="range-value">1.1</span></label>
                    <input type="range" id="repetitionPenalty" min="1.0" max="2.0" step="0.1" value="1.1">
                </div>
            </div>

            <!-- Content Filtering -->
            <div class="settings-section">
                <h3>üõ°Ô∏è Content Filtering</h3>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="disableFilter" checked>
                    <label for="disableFilter">Disable Content Filter</label>
                </div>
                
                <div class="setting-item">
                    <label for="filterStrictness">Filter Strictness</label>
                    <select id="filterStrictness">
                        <option value="disabled">Disabled</option>
                        <option value="relaxed">Relaxed</option>
                        <option value="balanced">Balanced</option>
                        <option value="strict">Strict</option>
                    </select>
                </div>
            </div>

            <!-- Voice Settings -->
            <div class="settings-section">
                <h3>üé§ Voice Settings</h3>
                
                <div class="setting-item">
                    <label for="language">Language</label>
                    <select id="language">
                        <option value="auto">Auto-detect</option>
                        <option value="ar">Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
                        <option value="en">English</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label for="voice">Voice</label>
                    <select id="voice">
                        <option value="ar-SA-ZariyahNeural">Arabic Female (Zariyah)</option>
                        <option value="ar-SA-HamedNeural">Arabic Male (Hamed)</option>
                        <option value="en-US-JennyNeural">English Female (Jenny)</option>
                        <option value="en-US-GuyNeural">English Male (Guy)</option>
                    </select>
                </div>

                <!-- Streaming / Legacy Mode Toggle -->
                <div class="checkbox-item">
                    <input type="checkbox" id="streamingVoiceToggle">
                    <label for="streamingVoiceToggle">Streaming Voice (Beta)</label>
                    <span class="streaming-badge" id="streamingModeBadge">STREAMING</span>
                </div>

                <div class="checkbox-item" data-vad-only>
                    <input type="checkbox" id="autoStart">
                    <label for="autoStart">Auto-start listening after response (VAD mode)</label>
                </div>
                
                <div class="checkbox-item" data-vad-only>
                    <input type="checkbox" id="autoStop">
                    <label for="autoStop">Auto-stop on silence (fallback mode)</label>
                </div>
                
                <div class="setting-item" data-vad-only>
                    <label for="silenceThreshold">Silence Threshold (fallback) <span id="silenceValue" class="range-value">3.0s</span></label>
                    <input type="range" id="silenceThreshold" min="1" max="5" step="0.5" value="3">
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Overlay -->
    <div id="voiceOverlay" class="voice-overlay hidden">
        <div class="voice-overlay-content">
            <div class="voice-overlay-header">
                <h2>üé§ Voice Chat</h2>
                <button id="closeVoiceOverlay" class="close-btn">&times;</button>
            </div>
            
            <div class="voice-settings-grid">
                <div class="voice-setting">
                    <label>Language</label>
                    <select id="overlayLanguage">
                        <option value="auto">Auto-detect</option>
                        <option value="ar" selected>Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
                        <option value="en" >English</option>
                    </select>
                </div>
                
                <div class="voice-setting">
                    <label>Voice</label>
                    <select id="overlayVoice">
                        <option value="ar-SA-ZariyahNeural">Arabic Female (Zariyah)</option>
                        <option value="ar-SA-HamedNeural">Arabic Male (Hamed)</option>
                        <option value="en-US-JennyNeural">English Female (Jenny)</option>
                        <option value="en-US-GuyNeural">English Male (Guy)</option>
                    </select>
                </div>
                
                <div class="voice-setting">
                    <label>Thinking Mode</label>
                    <select id="overlayThinkingMode">
                        <option value="relaxed">Relaxed</option>
                        <option value="balanced">Balanced</option>
                        <option value="strict">Strict</option>
                    </select>
                </div>
            </div>
            <!-- Streaming Toggle (Overlay) -->
            <div class="checkbox-setting" style="margin-bottom:20px; display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="overlayStreamingToggle">
                <label for="overlayStreamingToggle">Streaming Voice (Beta)</label>
                <span class="streaming-badge">STREAMING</span>
            </div>
            
            <div class="voice-detection-settings">
                <div class="checkbox-setting">
                    <input type="checkbox" id="overlayAutoStart">
                    <label for="overlayAutoStart">Auto-start listening after response (VAD mode)</label>
                </div>
                
                <div class="checkbox-setting">
                    <input type="checkbox" id="overlayAutoStop">
                    <label for="overlayAutoStop">Auto-stop on silence (fallback mode)</label>
                </div>
                
                                <div class="range-setting">
                    <label>Silence Threshold (fallback): <span id="overlaySilenceValue">3s</span></label>
                    <input type="range" id="overlaySilenceThreshold" min="1" max="5" step="0.5" value="3">
                </div>
            </div>
            
            <div class="voice-controls">
                <div id="overlayConnectionStatus" class="status-indicator disconnected">
                    <span>‚óè</span><span>Disconnected</span>
                </div>
                
                <button id="overlayVoiceToggle" class="voice-toggle-btn">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                    <span>Click to Listen</span>
                </button>
                
                <div id="overlayVoiceStatus" class="voice-status"></div>
            </div>
            
            <div class="voice-conversation" id="overlayConversation">
                <div class="conversation-placeholder">
                    <p>Start your voice conversation!</p>
                    <p>Click the microphone to start listening. AI will detect when you stop speaking.</p>
                </div>
            </div>
        </div>
    </div>

    

        <!-- Streaming Voice Feature Flag MUST load before chat-interface.js -->
        <script>
            window.BEAUTYAI_STREAMING_VOICE = true;
            // Allow overriding API host (e.g., different subdomain). If served from dev.gmai.sa, target api.gmai.sa.
            (function(){
                if (!window.BEAUTYAI_API_HOST) {
                    const hn = window.location.hostname;
                    if (/\.gmai\.sa$/i.test(hn) && !/^api\./i.test(hn)) {
                        window.BEAUTYAI_API_HOST = 'api.gmai.sa';
                    }
                }
            })();
        </script>
        <!-- Streaming client library (defines window.StreamingVoiceClient) BEFORE chat interface -->
        <script src="{{ url_for('static', filename='js/streamingVoiceClient.js') }}"></script>
        <!-- Main chat interface (will auto-init streaming if flag true) -->
        <script src="{{ url_for('static', filename='js/chat-interface.js') }}"></script>
        <script>
            // Inject live partial transcript container early (idempotent)
            document.addEventListener('DOMContentLoaded', () => {
                if (!document.getElementById('livePartialTranscript')) {
                    const live = document.createElement('div');
                    live.id = 'livePartialTranscript';
                    live.className = 'live-partial hidden';
                    live.setAttribute('aria-live','polite');
                    const msgs = document.getElementById('messagesContainer');
                    if (msgs && msgs.parentNode) msgs.parentNode.insertBefore(live, msgs);
                }
            });
        </script>
        <div id="streamingMetricsOverlay"></div>
</body>
</html>
